<script>
  function waitForCxone(callback) {
    if (typeof cxone === "function") {
      callback();
    } else {
      setTimeout(() => waitForCxone(callback), 100);
    }
  }

  waitForCxone(() => {
    // init CXone
    cxone("guide", "init");

    cxone("guide", "setCustomCss", `
      [data-selector="GUIDE_MENU_BUTTON"] {
        width: 74px !important;
        height: 74px !important;
        -webkit-box-shadow: 0 5px 11px 0 rgba(0, 0, 0, .2) !important;
        box-shadow: 0 5px 11px 0 rgba(0, 0, 0, .2) !important;
      }
    `);

    cxone("chat", "setCustomCss", `
      * {
        font-family: "Figtree" !important;
      }
      [data-selector="CUSTOMER_MESSAGE_BUBBLE"] {
        background-color: #008db3 !important;
        color: #ffffff !important;
      }
    `);

    cxone("guide", "setOffsetX", "78");
    cxone("guide", "setOffsetY", "150");

    cxone("chat", "sendFirstMessageAutomatically", "begin_conversation");
    cxone("chat", "autoStartSession");
    cxone("chat", "setCustomerName", "Customer Name");

    const guideEvents = ["templateDisplayed", "entrypointOpened"];
    function handleEvent(event) {
      observePrecontactSurvey();
      applyClickEventinAvatar();
    }

    guideEvents.forEach((eventType) => {
      window.addEventListener(eventType, handleEvent);
    });

    function observePrecontactSurvey() {
      const container = document.getElementById("cxone-guide-container");
      if (!container) return;

      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (
              node.matches &&
              node.matches('[data-selector="GUIDE_MENU_BUTTON"]')
            ) {
              applyClickEventinAvatar();
            }
          });
        });
      });

      observer.observe(container, {
        childList: true,
        subtree: true,
      });
    }

    function applyClickEventinAvatar() {
      const continueChatButton = document.querySelector('[title="Continue chat"]');
      if (continueChatButton) {
        continueChatButton.style.cursor = "pointer";
      }
    }
  });
</script>
