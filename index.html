<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartLess Mobile</title>

  <!-- Load CXone SDK (important: DO NOT defer this) -->
  <script src="https://smartless.cxengage.net/jsapi/sdk.js"></script>

  <!-- Optional: include Figtree font if you're using it -->
  <link href="https://fonts.googleapis.com/css2?family=Figtree&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: "Figtree", sans-serif;
    }
  </style>
</head>
<body>

  <!-- Optional visible content or logo for debugging -->
  <h1>SmartLess Mobile</h1>

  <script>
    // Wait until cxone SDK is defined before initializing
    function initCxOne() {
      if (typeof cxone !== 'function') {
        setTimeout(initCxOne, 100); // Wait until loaded
        return;
      }

      cxone("guide", "init");

      cxone("guide", "setCustomCss", `
        [data-selector="GUIDE_MENU_BUTTON"] {
          width: 74px !important;
          height: 74px !important;
          box-shadow: 0 5px 11px 0 rgba(0, 0, 0, .2) !important;
        }
      `);

      cxone("chat", "setCustomCss", `
        * {
          font-family: "Figtree" !important;
        }
        [data-selector="CUSTOMER_MESSAGE_BUBBLE"] {
          background-color: #008db3 !important;
          color: #ffffff !important;
        }
      `);

      cxone("guide", "setOffsetX", "78");
      cxone("guide", "setOffsetY", "150");
      cxone("chat", "sendFirstMessageAutomatically", "begin_conversation");
      cxone("chat", "autoStartSession");
      cxone("chat", "setCustomerName", "Customer Name");

      const guideEvents = ["templateDisplayed", "entrypointOpened"];
      guideEvents.forEach((eventType) => {
        window.addEventListener(eventType, handleEvent);
      });

      function handleEvent(event) {
        observePrecontactSurvey();
        applyClickEventinAvatar();
      }

      function observePrecontactSurvey() {
        const container = document.getElementById("cxone-guide-container");
        if (!container) return;

        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
              if (
                node.matches &&
                node.matches('[data-selector="GUIDE_MENU_BUTTON"]')
              ) {
                applyClickEventinAvatar();
              }
            });
          });
        });

        observer.observe(container, {
          childList: true,
          subtree: true,
        });
      }

      function applyClickEventinAvatar() {
        const continueChatButton = document.querySelector('[title="Continue chat"]');
        if (continueChatButton) {
          continueChatButton.style.cursor = "pointer";
        }
      }
    }

    window.addEventListener("load", initCxOne);
  </script>
</body>
</html>
